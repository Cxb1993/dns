TODO:

1.  alpha model
2.  4th order differences
10. use a mpi defined type for the buffer->2d array copy in transpose.F90
100. post more messages at once in tranpose.F90?  
101. divergence: go to Shashkov formula?  

**********************************************************************************
sizes
Nirvana:  32Gb per box.  optimal is 225M per CPU.  
          1 box: 29Gb,  max size: 600
          2 box: 58Gb.  max size: 760 
          4 box: 116Gb  max size: 950

QidSE:  16x4 cpus.  64Gb memory
Qid:   128x4        512Gb memory
                         

Linux box sizes:          3D array size: 3*8*n**3.  5 big arrays per run.
                                                    total size about 6 arrays
 64^3     38M            6M per array
 96^3    120M            20M per array, 100M total.  
128^3    281M            48M per array

extrapolated:
256^3   2.25Gb           .375M per variable
512^3:  18Gb             3Gb per vairalbe
1024^3  144Gb            24Gb per variable
2048^3  1152Gb           192Gb per variable      
4096^3  9216Gb           1536Gb per variable      

size = .1*n^3/64^3 

grid:  (n/256)**3 (n/256)

t=.05                              Nirv    BlueMtn      
one box timings:  256 on 32 cpus            > 15min
                  256 on 64 cpus   9.11m    8.32
                  256 on 128 cpus  7.65m    4.11m        
                  250 on 125 cpus  7.65m    3.98m

                  384 on 128 cpus.           no
                  375 on 125 cpus.           no
                  360 on 120 cpus.           no
                  400 on 5x1x25              27.03m
                  400 on 1x100               32.09m

t=-1  (one time step)
                  512^3 on 128 cpus:         4.81
                  512^3 on 256 cpus:         in
t=-5  (5 time step)
                  512^3 on 128 cpus:         
                  512^3 on 256 cpus:         



**********************************************************************************
Spectral Model 1 CPU timings.
1 CPU  96^3  120M  
*****************************************************************
./bench.sh 96
run 5 timesteps.  CFL=1.5/.25, no structure functions

darkstar (linux 1Ghz)
PGF90, FFT99, auto       2.90  2.90    
PGF90, FFT99, params     2.86  2.87


PGF90,FFT99, auto            1.16  1.15
IFC,FFT99, auto              1.07  1.07
IFC,FFT99, params            1.05  1.07
LF90,FFT99, auto             1.28  1.27

autrey (linux 1.? Ghz ) 
PGF90,STK2+PGCC, auto        1.41  1.40

PGF90,STK2+GCC, auto         1.53  1.53
IFC,STK2+GCC, auto           1.45  1.45
LF90,STK2+GCC, auto          2.01  2.01


Nirvana SGIFFT                2.92  2.92  2.93  2.94
Nirvana FFT99                 2.97  2.97  2.97
Nirvana STK                

Truchas (Compaq ES40)
FFT99,params                 1.03   1.03
CPQ,params                   1.00   1.00

STK2,auto                    1.07   1.07
FFT99,auto                   1.03   1.03
CPQ,auto                     0.99   0.99

*****************************************************************
1 CPU  512x512x1


*****************************************************************



**********************************************************************************
analytic CFL:  for RK4, norm(G)<2.4

dealiased:  k=KMAX*(2/3) = N/3 = 1/(3delx)


advection:  G = i 2pi  (u,v,w)dot(kx,ky,kz) delt  
            |G| <= 2pi/3 delt ( U/dx + V/dy + W/dz)

    (U/dx+V/dy+W/dz) delt <= 2.4 3 / 2pi = 1.15


diffusion: G = mu 4 pi^2 (kx^2 +ky^2 + kz^2)  delt
             = mu (4/9) pi^2 (delx^-2 + dely^-2 + delz^-2)

      mu delt/(delx^2+dely^2+delz^2)  < 2.4 (9/4) / pi^2  = .55

.70: unstable
.60: seems stable.  lets go with .55



**********************************************************************************
