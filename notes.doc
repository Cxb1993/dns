TODO:

test.sh:  ifort: some dimenion settings only agree 10 digits?
          pgf90 (sulaco):  run agree exactly
          gf95 (mac)  runs agree exactly

testvx.sh:  fixed! run in parallel at work.

dnsp    test output - make sure it is in correct format
                      (via restart?)
port ns_vorticity3 to ns.F90 model (since it will save 1 z transpose)

move scaling notes from runs.doc to here?

**********************************************************************************
test.sh with ifort bug:

problem seems to be output of FFT.  
but iFFT without dealiasing gives correct result. 

brokencase:    
integer,parameter :: nx1=3,nx2=130
integer,parameter :: ny1=4,ny2=131
integer,parameter :: nz1=2,nz2=2

same data, valus ar:  e-10
maxval before
  5.000000074505560E-002
   4   4   2  64   0   0         0.24525E-09
  89   4   2  43   0   0         0.24525E-09
  90   4   2  43   0   0        -0.13904E-09
  91   4   2  44   0   0         0.24525E-09
  92   4   2  44   0   0        -0.13119E-09
  93   4   2  45   0   0         0.24525E-09
  94   4   2  45   0   0        -0.12354E-09
  95   4   2  46   0   0         0.24525E-09
  96   4   2  46   0   0        -0.11608E-09
  97   4   2  47   0   0         0.24525E-09
  98   4   2  47   0   0        -0.10879E-09
  99   4   2  48   0   0         0.24525E-09
 100   4   2  48   0   0        -0.10166E-09
 101   4   2  49   0   0         0.24525E-09
 102   4   2  49   0   0        -0.94668E-10
 103   4   2  50   0   0         0.24525E-09
 104   4   2  50   0   0        -0.87811E-10
 105   4   2  51   0   0         0.24525E-09
 106   4   2  51   0   0        -0.81073E-10
 107   4   2  52   0   0         0.24525E-09
 108   4   2  52   0   0        -0.74444E-10
 109   4   2  53   0   0         0.24525E-09
 110   4   2  53   0   0        -0.67913E-10
 111   4   2  54   0   0         0.24525E-09
 112   4   2  54   0   0        -0.61471E-10
 113   4   2  55   0   0         0.24525E-09
 114   4   2  55   0   0        -0.55107E-10
 115   4   2  56   0   0         0.24525E-09
 116   4   2  56   0   0        -0.48813E-10
 117   4   2  57   0   0         0.24525E-09
 118   4   2  57   0   0        -0.42581E-10
 119   4   2  58   0   0         0.24525E-09
 120   4   2  58   0   0        -0.36401E-10
 121   4   2  59   0   0         0.24525E-09
 122   4   2  59   0   0        -0.30267E-10
 123   4   2  60   0   0         0.24525E-09
 124   4   2  60   0   0        -0.24169E-10
 125   4   2  61   0   0         0.24525E-09
 126   4   2  61   0   0        -0.18101E-10
 127   4   2  62   0   0         0.24525E-09
 128   4   2  62   0   0        -0.12056E-10
 129   4   2  63   0   0         0.24525E-09
 130   4   2  63   0   0        -0.60241E-11
 maxval after
  5.000000113727869E-002


working case:
integer,parameter :: nx1=1,nx2=128
integer,parameter :: ny1=1,ny2=128
integer,parameter :: nz1=1,nz2=1

 maxval before
  5.000000074505806E-002
   2   1   1  64   0   0         0.30493E-18
  87   1   1  43   0   0        -0.43850E-18
  88   1   1  43   0   0        -0.74460E-19
  89   1   1  44   0   0         0.11816E-18
  90   1   1  44   0   0         0.95345E-19
  91   1   1  45   0   0        -0.71686E-18
  92   1   1  45   0   0         0.83970E-18
  93   1   1  46   0   0        -0.80974E-18
  94   1   1  46   0   0        -0.57613E-18
  95   1   1  47   0   0        -0.75502E-18
  96   1   1  47   0   0        -0.14244E-18
  97   1   1  48   0   0        -0.21329E-18
  98   1   1  48   0   0        -0.14652E-17
  99   1   1  49   0   0         0.32134E-18
 100   1   1  49   0   0         0.29124E-18
 101   1   1  50   0   0         0.25119E-18
 102   1   1  50   0   0        -0.79089E-18
 103   1   1  51   0   0         0.26423E-18
 104   1   1  51   0   0         0.22634E-18
 105   1   1  52   0   0        -0.34563E-19
 106   1   1  52   0   0         0.10620E-18
 107   1   1  53   0   0         0.43173E-18
 108   1   1  53   0   0        -0.47450E-18
 109   1   1  54   0   0        -0.60446E-19
 110   1   1  54   0   0        -0.41604E-18
 111   1   1  55   0   0        -0.29928E-18
 112   1   1  55   0   0        -0.38142E-18
 113   1   1  56   0   0         0.30732E-18
 114   1   1  56   0   0        -0.65051E-18
 115   1   1  57   0   0        -0.16864E-18
 116   1   1  57   0   0         0.19067E-18
 117   1   1  58   0   0         0.74810E-18
 118   1   1  58   0   0        -0.25457E-18
 119   1   1  59   0   0         0.13751E-17
 120   1   1  59   0   0        -0.82152E-19
 121   1   1  60   0   0        -0.49277E-19
 122   1   1  60   0   0         0.14096E-18
 123   1   1  61   0   0        -0.10885E-18
 124   1   1  61   0   0         0.20563E-18
 125   1   1  62   0   0        -0.41327E-19
 126   1   1  62   0   0         0.11723E-18
 127   1   1  63   0   0        -0.86736E-18
 128   1   1  63   0   0         0.17347E-17
 maxval after
  5.000000074505806E-002

**********************************************************************************
0 BUG:  Energy, when computed in spectral space: the cos(N/2) mode
        is weighted to heavily.  Not a problem for any dealiased case
        since that mode will always be zero.  This effects many routines
        throughout the code. 

0 BUG:  25x1x1 decomp calling output1 on 250x250x250 grid
      but 1x1x25 works fine.  
      (needs 3GB to run)
       10/3/04: checked on kiwi with 5x1x1 and 1x1x5, both produced
       output files w/o any errors (didn't check output)

1. ns_ghost: 
        benchmark parallel decompostions
        1000^3  4th and spectral
        2000^3 on 512?
       
2. construct convergence test for KH problem
       use E&Liu KH problem?  what value of mu?
       mu=0:  at t=1, E is down .25e-6.  dk/dt = -1.25e-6
       mu=1.5e-6 at T=1  E is down 1.2e-4 and  dk/dt = -1.26e-4
       1e-5:  noisy
       1e-4:  a touch noisy
       2e-4: looks good, a little too smoothed 
      compare with spectral, 4th, 4th+1st order grad, or 1st order div
3. if run stops because u>1000, timings are incorrect

10. use a mpi defined type for the buffer->2d array copy in transpose.F90
100. post more messages at once in tranpose.F90?  


**********************************************************************************
to get files of HPSS with stripe set:
   xpsi get -pfsComp 32 dns/decay2048/\*4026.u

**********************************************************************************
Angle averging:  153 calls to transpose_z()
     1 stage RK:   9 transpose_z().  = 36 transposes per timestep
     angle averaging:  4.25 timesteps.
     True cost: 150 timesteps.

**********************************************************************************
memory use:
Q: 512x512x256: formula                 288Mb per cpu
                observed:               334M

1 cpu:       formula    observed
514x514x10    362         385
130x130x130   301         326   

**********************************************************************************
sizes
Nirvana:  32Gb per box.  optimal is 225M per CPU.  
          1 box: 29Gb,  max size: 600
          2 box: 58Gb.  max size: 760 
          4 box: 116Gb  max size: 950

QidSE:  16x4 cpus.  64Gb memory
Qid:   128x4        512Gb memory


Linux box sizes:          3D array size: 3*8*n**3.  5 big arrays per run.
                                                    total size about 6 arrays
 64^3     38M            6M per array
 96^3    120M            20M per array, 100M total.  
128^3    281M            48M per array

extrapolated:
256^3   2.25Gb           .375M per variable
384^3   7.8GB
480^3:  15Gb
512^3:  18Gb             3Gb per variable  (9GB per timestep.  4.5gb   130m gridpoints
640^3   29Gb
768^3   51Gb
1024^3  144Gb            24Gb per variable                             1b gridpoints
1536^3  486Gb            81Gb per variable
2048^3  1152Gb           192Gb per variable    
3072^3  3240Gb           needs at least 1620 cpus.  6x1x512?  
4096^3  9216Gb           1536Gb per variable      
                         needs 4.6K cpus at 2GB per cpu
                         NEC ESS 10Tb

with tracers:  5 big arrays + 13D:
               (6*3  + 5*NTRACERS)*8  = 144 + 40*NTRACERS
                10 Tracers:  3.8x more memory
                 1000^3 10 tracers: 550GB = 256 cpus NO.   
                  256^3 10 tracers: 8.6GB

**********************************************************************************
analytic CFL:  for RK4, norm(G)<2.4

dealiased:  k=KMAX*(2/3) = N/3 = 1/(3delx)


advection:  G = i 2pi  (u,v,w)dot(kx,ky,kz) delt  
            |G| <= 2pi/3 delt ( U/dx + V/dy + W/dz)

    (U/dx+V/dy+W/dz) delt <= 2.4 3 / 2pi = 1.15


diffusion: G = mu 4 pi^2 (kx^2 +ky^2 + kz^2)  delt
             = mu (4/9) pi^2 delt (delx^-2 + dely^-2 + delz^-2)

      mu delt (delx^-2+dely^-2+delz^-2)  < 2.4 (9/4) / pi^2  = .55

.70: unstable
.60: seems stable.  lets go with .55



**********************************************************************************
